<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>MAGIKS: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="/home/nimasoft/Downloads/MathJax-2.6-latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MAGIKS
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">Manipulator General Inverse Kinematic Solver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>#Skilled-PR2 (S-PR2)</p>
<h2>Introduction</h2>
<p>S-PR2 is a new and powerful Python based software package that can be used as a kinematic control toolbox for PR2 service robot. The software exploits an analytic Inverse Kinematic solver for PR2 redundant arm (7 DOF) with capability of optimum redundancy resolution. S-PR2 can be used by robot researchers and programmers to generate their desired trajectories in the operational space and execute on a physical robot or in simulation. The package gives PR2 robot, the skills of tracking a user-defined trajectory like writing letters or drawing shapes on the board.</p>
<p>S-PR2 provides an efficient and reliable development environment providing optimal and feasible kinematic control functions for PR2 users. S-PR2 has adopted the lastest techniques of the Inverse Kinematic (IK) solution in recent years.</p>
<h3>What is PR2?</h3>
<p>The PR2 is a wheel-based service robot produced by <a href="https://www.willowgarage.com/">Willow-Garage</a> with two 7-DOF arms, a tilting head and a sliding joint, adjusting the working height of the arms adding one degree of freedom to the system.</p>
<div class="image">
<img src="https://github.com/uts-magic-lab/Magiks/blob/master/documentation/s-pr2/figures/PR2_Robot_Willow_Garage_3.jpg"  width="700"/>
</div>
<p>The navigating platform can move on the floor and rotate around the <b>z</b> axis providing three extra degrees of freedom. In free-base mode, eleven degrees of freedom kinematically influence the position or orientation of one gripper.</p>
<h3>Currently Available IK solver (IK Fast)</h3>
<p>The available <a href="http://wiki.ros.org/pr2_kinematics/Tutorials/Tutorial%204">IK solver</a> for the PR2, which is a part of Robot Operating System (ROS), is fast but lacks some important advanced features required for generating smooth and reliable trajectories. The existing package:</p>
<ul>
<li>Only projects a single pose to the joint-space and not a trajectory</li>
<li>Does not provide all the available solutions (corresponding to a certain value of a redundant parameter)</li>
<li>Can not exploit the available redundancy in Degrees of Freedom (DOF) to minimise a desired cost function or to fulfil additional constraints</li>
<li>Cannot give self motion trajectory connecting two points in the solution manifold</li>
<li>Does not return a feasibility set for a redundant parameter to be chosen</li>
<li>Is fully embedded within the ROS system and cannot be easily replaced or migrated to other systems</li>
<li>Its algorithms are only provided in binary and so is not available to inspect or modify</li>
</ul>
<h3>Why use S-PR2?</h3>
<p>We introduced a comprehensive kinematic control software package for the PR2 robot, which is based on an analytic inverse kinematic solution and addresses all the aforementioned issues. S-PR2 generates more effective robot motion plans, hence it can be used to produce morereliable robot behaviours. In S-PR2, the method used for redundancy resolution exploits the advantage of the existence of an analytic IK solution for improving an iterative redundancy optimization in terms of reliability, accuracy, and computational cost where closed-form IK equations are used to reduce dimensionality and complexity of the objective function.</p>
<p>S-PR2 allows an end user to easily generate desired trajectories in task-space, project them to the joint-space while exploiting DOF redundancy, visualize the trajectories, and finally, execute them on a PR2 robot using simple Python function calls. The typical user does not need any specific knowledge of the underlying robot control system in order to use S-PR2. Expert robot programmers can, however, use the lower level function modules in S-PR2 to write customized IK control systems. Since, S-PR2 is written in pure Python scripting language, the kinematic software is agnostic to the underlying operation platform.</p>
<p>In the following sections, we will first describe the system structure and core functional modules in S-PR2, then each subcomponent will be briefly explained in terms of their methods and capabilities. Finally, an example of a practical application of the package is demonstrated.</p>
<h2>System Architechture</h2>
<p>S-PR2 is implemented in a hierarchical structure in which higher level classes inherit and extend functionalities of the lower level classes. The overall structure of S-PR2 is shown in Figure 1.</p>
<div class="image">
<img src="https://github.com/uts-magic-lab/Magiks/blob/master/documentation/s-pr2/figures/spr2_structure_diagram2.png"  width="800"/>
</div>
<p><b>Figure 1. Architecture diagram of S-PR2</b></p>
<p>The main engine module of S-PR2 is the <a href="http://uts-magic-lab.github.io/Magiks/namespacemagiks_1_1specific__geometries_1_1pr2_1_1pr2__arm__kinematics.html">```PR2_Arm_Kinematics```</a> containing all the required kinematic methods, including an analytic arm IK solver and an optimal trajectory planner for the 7-DOF PR2 arm. This component inherits joint-space methods and properties from a generalized class called <a href="http://uts-magic-lab.github.io/Magiks/classmagiks_1_1specific__geometries_1_1pr2_1_1pr2__arm__kinematics_1_1_p_r2___a_r_m___configuration.html">```PR2_ARM_Configuration()```</a>. Each module instance is constructed with an ensemble of setting parameters specific to the object like mechanical limits and a set of weightings for each joint that is used in defining a user-defined objective function. The settings in the <code>PR2_Arm_Kinematics</code> module contain the robot main dimensions and algorithmic settings used for the inverse kinematics and redundancy optimization calculation. The entire kinematics of the robot are computed in a higher level module called <a href="http://uts-magic-lab.github.io/Magiks/namespacemagiks_1_1specific__geometries_1_1pr2_1_1pr2__kinematics.html">```PR2_Kinematics```</a>. This module supports a comprehensive kinematic engine for the PR2 using the IK solvers of the arms. Class <a href="http://uts-magic-lab.github.io/Magiks/classmagiks_1_1specific__geometries_1_1pr2_1_1pr2__kinematics_1_1_p_r2.html">```PR2()```</a> defined in this module contains two instances of <a href="http://uts-magic-lab.github.io/Magiks/classmagiks_1_1specific__geometries_1_1pr2_1_1pr2__arm__kinematics_1_1_p_r2___a_r_m.html">```PR2_Arm()```</a> for the right and the left arms. A user can define a target pose in terms of position and orientation or a <a href="http://uts-magic-lab.github.io/Magiks/namespacemath__tools_1_1geometry_1_1trajectory.html">pose trajectory</a> for each of the arm grippers in a global reference coordinate system and solve the IK or project the pose or trajectory into the joint-space. The free-base mode optimizer computes the optimum trunk position, rotation angle, and trunk height for a desired end-effector pose. All the above modules perform necessary computations and are completely independent of the actual robot operations.</p>
<h3>Connection to the real robot</h3>
<p>Up to here, we have introduced objects by which one can compute all forward and inverse kinematic propeties of the PR2 robot but these objects are ensembles of methods and properties and can not communicate with the real robot. To communicate to the physical robot, a ROS interface is required. Developers are free to choose between writing their own ROS interface or use the interface embedded in S-PR2.</p>
<p>In S-PR2, access to the physical robot platform is established by a connector module named <a href="http://uts-magic-lab.github.io/Magiks/namespacemagiks_1_1specific__geometries_1_1pr2_1_1pyride__synchronizer.html">```PyRide_Synchronizer```</a>. This module contains a class named <a href="http://uts-magic-lab.github.io/Magiks/classmagiks_1_1specific__geometries_1_1pr2_1_1pyride__synchronizer_1_1_py_ride___p_r2.html">```PyRide_PR2()```</a> inherited from <code>PR2()</code> that enables the object to synchronize itself with the real robot or robot in simulation via a middleware toolbox named <a href="https://github.com/uts-magic-lab/pyride_pr2">**PyRIDE**</a> which is the interface between S-PR2 and ROS and acts as an intermediary agent to the low level robot control system.</p>
<p>The actual communication with <b>PyRIDE</b> is done via an interface module named <a href="http://uts-magic-lab.github.io/Magiks/namespacemagiks_1_1specific__geometries_1_1pr2_1_1pyride__interpreter.html">pyride_interpreter</a> which carries out the control commands and data mappings, and communicates with PyRide.</p>
<p>Finally, class <a href="http://uts-magic-lab.github.io/Magiks/classmagiks_1_1specific__geometries_1_1pr2_1_1skilled__pr2_1_1_skilled___p_r2.html">```Skilled_PR2()```</a> inherited from <code>PYRide_PR2()</code> is the final module in the package with the highest level of functionality. This class supports basic primitive motion skills like moving in various directions, running internal motion into a low cost configuration or trajectory tracking. The end user can create his/her own PR2 controller class inherited from <code>Skilled-PR2()</code> and add more skills.</p>
<p>An example of a user-defined class inherited from <code>Skilled-PR2()</code> is placed in the package named as <a href="http://uts-magic-lab.github.io/Magiks/classmagiks_1_1specific__geometries_1_1pr2_1_1writer__pr2_1_1_writer___p_r2.html">```Writer-PR2()```</a> and shows how some of the functionalities of S-PR2 are utilized to provide writing skills for the robot. It is a working example designed to enable the PR2 to copy a wide range of motion trajectories for writing and drawing purposes.</p>
<h2>PR2 Arm Kinematic Module</h2>
<p>Module <a href="http://uts-magic-lab.github.io/Magiks/namespacemagiks_1_1specific__geometries_1_1pr2_1_1pr2__arm__kinematics.html">```PR2_arm_kinematics```</a> is the main kinematic engine of S-PR2 with the lowest level of functionality. This module provides methods required for kinematic computations of the PR2 arm.</p>
<h3>Analytic Inverse Kinematic Solver</h3>
<p>The most important part of the module is an analytic IK solver that can give all the feasible configurations corresponding to a desired EE pose for an arbitrary value of the redundant parameter (up to maximum 8 solutions). The redundant parameter is by default selected as the first arm joint named Shoulder-Pan Joint. If the given task pose is outside the arm’s reachable region or an ill chosen value is used for the redundant parameter, no solution can be found by the solver. Since identifying the reason for failing to find a solution can be difficult, S-PR2 provides a feasibility Permission Set for the redundant parameter and searches within this set to find a value that leads to a solution with respect to the user’s desired criterion, i.e. the distance of the current configuration from the middle of the joint ranges. If the computed permission set is empty, then it is certain that the requested task pose lies outside of the robot workspace in which case no valid solution exists.</p>
<h3>Permission Set</h3>
<p>In IK problems, the key challenge is to use redundancy to find the optimal joint values within their feasible ranges. Each joint limitation makes part of the solution manifold invalid and imposes a restriction on the feasible domain from which the redundant parameters can be chosen. For the PR2 that has only one redundant parameter in its manipulator, a Permission Set consisting of a union of intervals can be obtained by the intersection of feasibility permission sets imposed on the redundant parameter by the limitations of each joint. In other words, a permission set is a set from which the redundant parameter must be selected otherwise no solution in the feasible range can be found for the desired EE pose. S-PR2 can compute the permission set for a given desired EE pose using <a href="https://en.wikipedia.org/wiki/Interval_arithmetic">Arithmetic of Intervals</a>.</p>
<h3>Optimal Redundancy Resolution</h3>
<p>A task in the cartesian space requires six kinematic constraints for the endeffector. If the number of free joints (DOF) is greater than the number of constraints required to fulfil a task, the robot is said to be in a Redundant state. In this case, one or some of the joints can be arbitrarily chosen as redundant parameters. It is also possible to consider a user-defined function of joints as a redundant parameter. Selecting an appropriate function for redundant parameters is called parametrization and it depends upon the geometry of the manipulator. Each redundant parameter adds an additional constraint to the system, so the total number of redundant parameters denoted as Degree of Redundancy is computed as <em>r = n − m</em> where <em>n</em> is the degree of freedom and <em>m</em> is the number of main kinematics constraints (<em>m = 6</em> for a desired end effector position and orientation).</p>
<p>Some redundancy parametrizations have been proposed for specific geometries, like <a href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&amp;arnumber=131621&amp;url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D131621">Lee and Bejczy</a> who used some of the joints as redundant parameters in a 8 DOF arm or <a href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&amp;arnumber=4631505&amp;url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D4631505">Shimizu et.al.</a>, who used a user defined angle as the redundant parameter in a 7 DOF arm. The analytic solution of IK in redundant systems is to express joint positions as closed-form functions of redundant parameters, and the problem of Optimal Redundancy Resolution in analytic IK is to find a feasible value for the redundant parameter(s) to minimize a desired cost function subject to some additional constraints. The method used for redundancy resolution in fixed-base mode is similar to Shimizu’s work but with a different parametrization. The analytic IK method used is also different as their formulations could not be used for the PR2 arm due to a slight difference in the <a href="http://wiki.ros.org/pr2_calibration_estimation">Denavit-Hartenberg (DH) parameters</a> of the PR2 arms.</p>
<h3>Smooth Trajectory Projection</h3>
<p>The arm kinematic module can project a trajectory from task-space into the joint-space. Trajectories are instances of module Trajectory consisting of segments established from a number of key points containing positions, velocities and accelerations. Each key point can apply constraint(s) to the trajectory. Trajectory points are interpolated from a fitted spline in form of a polynomial or Fourier series. The user can visualize both joint-space and task-space trajectories before executing them on a physical robot. Orientation-Trajectory is a module inherited from Trajectory supported by various methods for smooth orientation trajectory interpolation. Given the key orientations and corresponding angular velocities and accelerations, the interpolated orientation can be computed at any phase value using methods like <a href="https://en.wikipedia.org/wiki/Slerp">SLERP</a> with various conventions like quaternions or rotation matrix. The module also supports polynomial interpolation using one of the <a href="http://link.springer.com/article/10.1023%2FA%3A1024265401576">vectorial</a> non-redundant representations of three-dimensional rotation.</p>
<h3>Self Motion Generation</h3>
<p>In a redundant manipulator, if the EE is fixed in some pose, the joints can still change in the solution manifold to generate a motion that does not influence the end effector pose. This is known as the <em>self Motion</em>. Different values of the joints in the solution manifold can be achieved by changing the redundant parameters. The arm kinematic module in S-PR2 is able to generate a smooth internal motion within the solution manifold, connecting two different IK solution points in the joint-space. This enables the robot to change itself into a better configuration while the end effector pose is fixed.</p>
<h2>PR2 Kinematics Module</h2>
<p>The <a href="http://uts-magic-lab.github.io/Magiks/namespacemagiks_1_1specific__geometries_1_1pr2_1_1pr2__kinematics.html">```PR2_Kinematics```</a> module is a comprehensive toolbox for all kinematic computations of the PR2. It exploits the arm local IK solver to compute the configuration in terms of eleven joints (degrees of freedom) given the desired end effector pose in the global coordinate system. This module also generates optimal trajectories for each of the eleven degrees of freedom corresponding to a desired task.</p>
<h3>Redundancy Resolution in Free-Base Mode</h3>
<p>In free-base mode, the redundancy resolution technique used for the arm is extended to five redundant parameters for the entire robot. In free-base mode, the position, orientation and height of the robot trunk are computed so that a desired cost function is minimized. This is another useful feature that can not be found in any of the existing packages for PR2. With the closed form arm IK equations, the redundancy optimization problem is transferred from the eleven dimensional joint-space into a five dimensional solution manifold spanned by the redundant parameters. In this method, gradients of the objective function with respect to redundant parameters are computed to find an optimum direction for the change of redundant parameters and hence the joint values.</p>
<h2>Application Example</h2>
<p>Writing and drawing are complicated tasks that require high accuracy and an understanding of the environment. We used S-PR2 to create a system that enables PR2 to write letters or draw any desired shape on the board: Writer-PR2. Raw trajectories are given by an external device such as an iPad tablet or loaded from a file containing some predefined trajectories (for example English alphabets), then mapped into the desired size, location, and orientation. They are then projected into a feasible joint-space trajectory according to the current robot state and configuration. The shapes or letters are drawn/written by any of the arms with desired size and speed. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun May 8 2016 22:15:12 for MAGIKS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
